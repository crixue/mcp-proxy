FROM ghcr.io/sparfenyuk/mcp-proxy:v0.8.2

# Configure pip to use Tsinghua mirror
RUN mkdir -p /root/.pip && \
    echo "[global]" > /root/.pip/pip.conf && \
    echo "index-url = https://pypi.tuna.tsinghua.edu.cn/simple/" >> /root/.pip/pip.conf && \
    echo "trusted-host = pypi.tuna.tsinghua.edu.cn" >> /root/.pip/pip.conf

RUN mkdir -p /root/.config/uv && \
    echo "[[index]]" > /root/.config/uv/uv.toml && \
    echo "url = \"https://pypi.tuna.tsinghua.edu.cn/simple\"" >> /root/.config/uv/uv.toml && \
    echo "default = true" >> /root/.config/uv/uv.toml

# Install the 'uv' package
RUN python3 -m ensurepip && pip install --no-cache-dir uv

ENV PATH="/usr/local/bin:$PATH" \
    UV_PYTHON_PREFERENCE=only-system \
    UV_INDEX_URL=https://pypi.tuna.tsinghua.edu.cn/simple/

EXPOSE 8080

ENTRYPOINT [ "mcp-proxy" ]